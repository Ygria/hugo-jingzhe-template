{{/* {{ $result := transform.HighlightCodeBlock . }} */}}
{{- $id := dict "Scratch" .Page.Scratch | partial "function/id.html" -}}
{{- $title := .Attributes.title | default .Type | default "text" -}}
{{- $language := .Type | default "text" -}}
{{- $theme := .Attributes.theme | default "breeze" -}}
{{- $mode := .Attributes.mode | default "light" -}}
{{/* 默认根据主题，显示背景图片 */}}
{{- $nobackground := .Attributes.nobackground | default false -}}
{{- $padding := .Attributes.padding | default 64 -}}
{{- $lineNos := cond (eq .Options.linenos false) "" "show-line-numbers" -}}
{{- $lines := len (split .Inner "\n") -}}
{{- $maxShownLines := .Page.Params.code.maxshownlines | default site.Params.page.code.maxshownlines -}}
{{- $open := "is-open" -}}
{{- if eq .Attributes.open nil -}}
{{- $open = cond (gt $lines $maxShownLines) "is-closed" "is-open" -}}
{{- else -}}
{{- $open = cond (eq .Attributes.open false) "is-closed" "is-open" -}}
{{- end -}}
{{- $wrap := cond (eq .Attributes.wrap true) "is-wrap" "" -}}
{{- $header := cond (eq .Attributes.header false) "tw-hidden" "" -}}

<div class="code-block  {{ $open }} {{ $lineNos }} {{ $wrap }} tw-group tw-my-2">
  <div class="code-wrapper {{$mode}}" data-theme="{{$mode}}" id="code-block-{{$id}}">
    {{ if eq $nobackground false }}
    <div class="withBackground {{ $theme }}" style = "padding: {{ $padding }}px"/>
    {{ end }}
    <div class="window">
      <div id="codeblock-header" class="header">
        <div class="controls">
          <div class="control"></div>
          <div class="control"></div>
          <div class="control"></div>
        </div>
        <div className={classNames(styles.fileName, styles.supabaseFileName)} id="codeblock-title" class="fileName"
          data-value={fileName}>
          <span> {{ $title }}</span>
        </div>
        <div class="controls-buttons" id="controls-button-{{$id}}">
          <button id="copyButton-{{ $id }}">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#000"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy">
              <rect width="14" height="14" x="8" y="8" rx="2" ry="2" />
              <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" />
            </svg>
          </button>
          <button id="copySuccess-{{ $id }}" style="display: none;" class="not-allowed" >
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="green" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              class="lucide lucide-clipboard-check">
              <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
              <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
              <path d="m9 14 2 2 4-4" />
            </svg>
          </button>

          <button id="exportImage-{{ $id }}">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              class="lucide lucide-download">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="7 10 12 15 17 10" />
              <line x1="12" x2="12" y1="15" y2="3" />
            </svg>
          </button>
        </div>
      </div>
      <div data-language="{{ $language}}" data-theme="{{ $theme}}" id="code-{{ $id }}">{{ .Inner }}</div>
    </div>
  </div>
</div>